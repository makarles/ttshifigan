## Реализация вокодера HiFi-GAN для синтеза речи

Датасет: [RUSLAN](https://ruslan-corpus.github.io/) (22.05 kHz) 

Автор: Макар Лесниченко

------------------------------------------------------------------------

# 1. Введение

В рамках данной работы была реализована и обучена нейросетевая модель
вокодера на основе архитектуры HiFi-GAN для генерации речевого сигнала
из мел-спектрограмм.

Основная цель проекта — построить:

-   стабильный GAN-вокодер,
-   воспроизводимый пайплайн обучения,
-   корректный режим resynthesis (Audio → Mel → Vocoder → Audio),
-   демонстрационный ноутбук для Google Colab,
-   систему логирования обучения.

Проект полностью реализован с нуля без использования предобученных
вокодеров.

------------------------------------------------------------------------


# 2. Используемые данные

Обучение проводилось на датасете RUSLAN.

-   Исходная частота записи: 44100 Hz
-   В работе использована частота: 22050 Hz (с ресемплированием)
-   Формат признаков: 80-мерные мел-спектрограммы

Для демонстрации в репозитории используются:

-   [ruslan_50](https://drive.google.com/drive/folders/1sKwsSfRuW4ZsgIbnoG90uBPWz16s48Hh?usp=drive_link) — подмножество из 50 аудиофайлов
-   [mos_gt](https://drive.google.com/drive/folders/1KrDyNdbGdOz32gmIrbFrV2RstpFxoQwe?usp=sharing) — 3 аудиофайла для MOS-оценки

Демо-данные автоматически скачиваются через demo.ipynb.

------------------------------------------------------------------------

# 3. Архитектура модели

Использована архитектура HiFi-GAN (V2):

-   Generator с residual блоками
-   Multi-Period Discriminator (MPD)
-   Multi-Scale Discriminator (MSD)
-   Mel-spectrogram L1 loss
-   Feature Matching Loss
-   Adversarial Loss

Формирование mel-спектрограмм:

-   n_fft = 1024
-   hop_length = 256
-   win_length = 1024
-   n_mels = 80
-   f_min = 0
-   f_max = 11025

------------------------------------------------------------------------

# 4. Стратегия обучения

Обучение проводилось на RTX 4070 (12GB) в две фазы с целью повысить стабильность и качество GAN.

------------------------------------------------------------------------

# 4.1 Фаза 1 — Базовое обучение

Цель: - стабилизация GAN - обучение грубой структуры сигнала

Параметры фазы 1

| Параметр       | Значение      |
|----------------|---------------|
| sample_rate    | 22050         |
| segment_size   | 16384         |
| batch_size     | 8             |
| learning_rate  | 5e-5          |
| betas          | (0.8, 0.99)   |
| weight_decay   | 0.0           |
| max_steps      | 120000        |

На этом этапе модель достигла устойчивой сходимости.

------------------------------------------------------------------------

# 4.2 Фаза 2 — Fine-Tuning

Цель: - улучшение высокочастотных компонент - снижение шумов - повышение
спектральной детализации

Фаза 2 запускалась с чекпойнта фазы 1.

Параметры фазы 2

| Параметр               | Значение      |
|------------------------|---------------|
| sample_rate            | 22050         |
| segment_size           | 16384         |
| batch_size             | 8             |
| learning_rate          | 2e-5          |
| betas                  | (0.8, 0.99)   |
| weight_decay           | 0.0           |
| max_steps              | 180000        |

Понижение learning rate позволило более аккуратно донастроить генератор
без разрушения уже выученной структуры сигнала.

------------------------------------------------------------------------

# 5. Логирование (Weights & Biases)

Для логирования использовался Weights & Biases в offline-режиме.

Во время синхронизации возникла ошибка авторизации (HTTP 403), из-за
чего (скорее всего, из-за блокировки сервиса в России...), поэтому история метрик (history) не была загружена в облако.
Прошу прощения.

Это не повлияло на обучение, но ограничило визуализацию динамики лоссов.
Логи сохранились на локальном ПК, на котором проводилось обучение модели. Прош

------------------------------------------------------------------------

# 6. Результаты

Сильные стороны

-   разборчивая речь
-   корректная временная структура
-   отсутствие сильных шумов
-   стабильная генерация
-   RTF значительно меньше 1

Недостатки

-   лёгкая синтетичность звучания
-   незначительная «картавость»
-   сглаженные высокие частоты

В целом качество можно охарактеризовать как не идеальное, но уверенно
приемлемое для базовой реализации HiFi-GAN.

------------------------------------------------------------------------

# 7. Скорость инференса

Измеренный Real-Time Factor:

RTF ≈ 0.06

Это означает, что модель работает примерно в 16 раз быстрее реального
времени на GPU.

------------------------------------------------------------------------

# 8. Графики

Сравнение waveform и STFT представлено в директориях:

-   ttshifigan/report_figs/
-   ttshifigan/report_figs_mos/

Графики демонстрируют относительно хорошее совпадение спектральной структуры с
референсом.

------------------------------------------------------------------------

# 9. Установка

   ```bash
   git clone https://github.com/makarles/ttshifigan.git
   cd ttshifigan
   pip install -r requirements.txt
   ```

------------------------------------------------------------------------

# 10. Чекпойнт

Файл last.pt (~800 MB) размещён на [Google Drive](https://drive.google.com/file/d/1HZ-NSQ0c3f_ZUhCibULGdMXGn2HHcbzC/view?usp=sharing).



После скачивания необходимо поместить его в:

    checkpoints/last.pt

------------------------------------------------------------------------

# 11. Demo (Google Colab)

Файл [demo.ipynb](https://colab.research.google.com/github/makarles/ttshifigan/blob/main/demo.ipynb):

-   клонирует репозиторий
-   устанавливает зависимости
-   скачивает веса
-   скачивает demo-данные
-   запускает resynthesis
-   генерирует MOS-примеры
-   измеряет скорость инференса

Ноутбук полностью воспроизводим.

------------------------------------------------------------------------

12. Заключение

Вокодер HiFi-GAN успешно обучен на датасете RUSLAN.

Модель: 
- стабильно работает
- генерирует разборчивую речь
- демонстрирует высокую скорость инференса
- воспроизводима через demo-ноутбук.


